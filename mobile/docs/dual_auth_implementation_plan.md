# Dual Authentication Implementation Plan - AgriConnect

## Overview

Ce document d√©taille le plan d'impl√©mentation de la **strat√©gie d'authentification duale** d'AgriConnect : OTP SMS pour l'application mobile et Email/Password pour l'application web. L'impl√©mentation se fait en 4 phases sur 4 semaines.

---

## **Phase 1: Configuration Supabase Auth Duale (Semaine 1)** ‚öôÔ∏è

### **Objectif**
Configurer Supabase Auth pour supporter les deux m√©thodes d'authentification : OTP SMS (Mobile) et Email/Password (Web).

### **T√¢ches D√©taill√©es**

#### **1.1 Configuration OTP SMS avec Twilio**
- [ ] **Cr√©er compte Twilio** (si pas existant)
  - Obtenir Account SID, Auth Token, Message Service SID
  - Configurer le num√©ro de t√©l√©phone d'envoi
  - Tester l'envoi de SMS

- [ ] **Configuration Supabase Dashboard**
  ```typescript
  // Supabase > Auth > Providers > Phone
  {
    "enabled": true,
    "provider": "twilio",
    "twilio_account_sid": "env.TWILIO_ACCOUNT_SID",
    "twilio_auth_token": "env.TWILIO_AUTH_TOKEN",
    "twilio_message_service_sid": "env.TWILIO_MESSAGE_SERVICE_SID"
  }
  ```

- [ ] **Configuration des Templates SMS**
  ```typescript
  // Template OTP
  "Votre code AgriConnect: {{ .Code }}"
  
  // Param√®tres
  "expiry": 600,        // 10 minutes
  "rate_limit": 3,      // 3 tentatives par heure
  "should_create_user": false
  ```

#### **1.2 Configuration Email/Password avec SMTP**
- [ ] **Configuration SMTP dans Supabase**
  ```typescript
  // Supabase > Auth > SMTP
  {
    "enabled": true,
    "host": "env.SMTP_HOST",
    "port": 587,
    "user": "env.SMTP_USER",
    "pass": "env.SMTP_PASS",
    "admin_email": "admin@agriconnect.sn"
  }
  ```

- [ ] **Configuration Email Provider**
  ```typescript
  // Supabase > Auth > Providers > Email
  {
    "enabled": true,
    "double_confirm_changes": true,
    "enable_signup": false,  // Cr√©ation manuelle par admin
    "confirm_email_change": true
  }
  ```

#### **1.3 Configuration des Variables d'Environnement**
- [ ] **Mise √† jour `.env.example`**
  ```bash
  # Twilio Configuration
  TWILIO_ACCOUNT_SID=your_account_sid
  TWILIO_AUTH_TOKEN=your_auth_token
  TWILIO_MESSAGE_SERVICE_SID=your_message_service_sid
  
  # SMTP Configuration
  SMTP_HOST=smtp.gmail.com
  SMTP_USER=your_email@gmail.com
  SMTP_PASS=your_app_password
  ```

- [ ] **Mise √† jour des fichiers d'environnement**
  - `mobile/.env`
  - `web/.env`
  - `supabase/.env`

#### **1.4 Tests de Configuration**
- [ ] **Test OTP SMS**
  - Envoi de code OTP vers un num√©ro de test
  - V√©rification de la r√©ception
  - Validation de l'expiration

- [ ] **Test Email/Password**
  - Envoi d'email de confirmation
  - Test de r√©initialisation de mot de passe
  - Validation des templates

### **Livrables Phase 1**
- ‚úÖ Configuration OTP SMS Twilio fonctionnelle
- ‚úÖ Configuration SMTP Email/Password fonctionnelle
- ‚úÖ Variables d'environnement configur√©es
- ‚úÖ Tests de configuration valid√©s

---

## **Phase 2: Authentification Mobile OTP SMS (Semaine 2)** üì±

### **Objectif**
Impl√©menter l'authentification OTP SMS pour l'application mobile React Native, incluant les √©crans de connexion et la gestion des sessions.

### **T√¢ches D√©taill√©es**

#### **2.1 Service d'Authentification Mobile**
- [ ] **Cr√©er `mobile/lib/auth/mobileAuthService.ts`**
  ```typescript
  export class MobileAuthService {
    static async sendOTP(phone: string): Promise<void>
    static async verifyOTP(phone: string, otp: string): Promise<AuthSession>
    static async getCurrentSession(): Promise<AuthSession | null>
    static async refreshSession(): Promise<AuthSession>
    static async signOut(): Promise<void>
  }
  ```

- [ ] **Gestionnaire de Sessions**
  ```typescript
  // mobile/lib/auth/sessionManager.ts
  export class SessionManager {
    static async ensureValidSession(): Promise<AuthSession>
    static async refreshSession(): Promise<AuthSession>
    static async clearSession(): Promise<void>
  }
  ```

#### **2.2 √âcrans d'Authentification Mobile**
- [ ] **√âcran de Connexion** (`mobile/app/(auth)/login.tsx`)
  ```typescript
  // Composants
  - PhoneInput: Saisie du num√©ro de t√©l√©phone
  - SendOTPButton: Envoi du code OTP
  - OTPInput: Saisie du code OTP
  - VerifyOTPButton: V√©rification du code
  - LoadingStates: √âtats de chargement
  - ErrorMessages: Gestion des erreurs
  ```

- [ ] **√âcran d'Inscription** (`mobile/app/(auth)/register.tsx`)
  ```typescript
  // Composants
  - UserTypeSelector: Agent ou Producteur
  - PhoneInput: Num√©ro de t√©l√©phone
  - CooperativeSelector: S√©lection coop√©rative
  - SendOTPButton: Envoi OTP
  - OTPVerification: V√©rification OTP
  - ProfileCompletion: Compl√©tion profil
  ```

#### **2.3 Gestion des √âtats d'Authentification**
- [ ] **Context d'Authentification** (`mobile/context/AuthContext.tsx`)
  ```typescript
  interface AuthContextType {
    user: User | null
    session: AuthSession | null
    loading: boolean
    signIn: (phone: string) => Promise<void>
    verifyOTP: (phone: string, otp: string) => Promise<void>
    signOut: () => Promise<void>
    refreshSession: () => Promise<void>
  }
  ```

- [ ] **Hook d'Authentification** (`mobile/hooks/useAuth.ts`)
  ```typescript
  export const useAuth = () => {
    const { user, session, loading, signIn, verifyOTP, signOut } = useContext(AuthContext)
    return { user, session, loading, signIn, verifyOTP, signOut }
  }
  ```

#### **2.4 Navigation et Protection des Routes**
- [ ] **Protection des Routes** (`mobile/app/_layout.tsx`)
  ```typescript
  // V√©rification de l'authentification
  const { session, loading } = useAuth()
  
  if (loading) return <LoadingScreen />
  if (!session) return <AuthNavigator />
  return <MainNavigator />
  ```

- [ ] **Gestion des Redirections**
  - Redirection automatique apr√®s connexion
  - Protection des routes authentifi√©es
  - Gestion des sessions expir√©es

#### **2.5 Tests OTP SMS**
- [ ] **Tests Unitaires**
  - Test du service d'authentification
  - Test de la gestion des sessions
  - Test de la validation des entr√©es

- [ ] **Tests d'Int√©gration**
  - Test complet du flux OTP SMS
  - Test de la gestion des erreurs
  - Test de la persistance des sessions

### **Livrables Phase 2**
- ‚úÖ Service d'authentification mobile OTP SMS
- ‚úÖ √âcrans de connexion/inscription mobile
- ‚úÖ Gestion des sessions JWT pour mobile
- ‚úÖ Tests OTP SMS valid√©s
- ‚úÖ Navigation et protection des routes

---

## **Phase 3: Authentification Web Email/Password (Semaine 3)** üåê

### **Objectif**
Impl√©menter l'authentification Email/Password pour l'application web React, incluant les √©crans de connexion et la gestion des sessions.

### **T√¢ches D√©taill√©es**

#### **3.1 Service d'Authentification Web**
- [ ] **Cr√©er `web/src/services/webAuthService.ts`**
  ```typescript
  export class WebAuthService {
    static async signIn(email: string, password: string): Promise<AuthSession>
    static async createUser(email: string, password: string, role: WebUserRole): Promise<void>
    static async resetPassword(email: string): Promise<void>
    static async getCurrentSession(): Promise<AuthSession | null>
    static async signOut(): Promise<void>
  }
  ```

- [ ] **Gestionnaire de Sessions Web**
  ```typescript
  // web/src/services/sessionManager.ts
  export class WebSessionManager {
    static async ensureValidSession(): Promise<AuthSession>
    static async refreshSession(): Promise<AuthSession>
    static async clearSession(): Promise<void>
  }
  ```

#### **3.2 √âcrans d'Authentification Web**
- [ ] **Page de Connexion** (`web/src/pages/auth/Login.tsx`)
  ```typescript
  // Composants
  - EmailInput: Saisie de l'email
  - PasswordInput: Saisie du mot de passe
  - SignInButton: Bouton de connexion
  - ForgotPasswordLink: Lien mot de passe oubli√©
  - LoadingStates: √âtats de chargement
  - ErrorMessages: Gestion des erreurs
  ```

- [ ] **Page d'Inscription** (`web/src/pages/auth/Signup.tsx`)
  ```typescript
  // Composants
  - EmailInput: Saisie de l'email
  - PasswordInput: Saisie du mot de passe
  - ConfirmPasswordInput: Confirmation du mot de passe
  - RoleSelector: S√©lection du r√¥le (Admin/Superviseur)
  - CooperativeSelector: S√©lection coop√©rative
  - SignUpButton: Bouton d'inscription
  ```

- [ ] **Page de R√©initialisation** (`web/src/pages/auth/ResetPassword.tsx`)
  ```typescript
  // Composants
  - EmailInput: Saisie de l'email
  - SendResetButton: Envoi du lien de r√©initialisation
  - NewPasswordInput: Nouveau mot de passe
  - ConfirmPasswordInput: Confirmation du mot de passe
  - UpdatePasswordButton: Mise √† jour du mot de passe
  ```

#### **3.3 Gestion des √âtats d'Authentification Web**
- [ ] **Context d'Authentification Web** (`web/src/context/AuthContext.tsx`)
  ```typescript
  interface WebAuthContextType {
    user: User | null
    session: AuthSession | null
    loading: boolean
    signIn: (email: string, password: string) => Promise<void>
    signUp: (email: string, password: string, role: WebUserRole) => Promise<void>
    resetPassword: (email: string) => Promise<void>
    signOut: () => Promise<void>
    refreshSession: () => Promise<void>
  }
  ```

- [ ] **Hook d'Authentification Web** (`web/src/hooks/useAuth.ts`)
  ```typescript
  export const useAuth = () => {
    const { user, session, loading, signIn, signUp, resetPassword, signOut } = useContext(WebAuthContext)
    return { user, session, loading, signIn, signUp, resetPassword, signOut }
  }
  ```

#### **3.4 Navigation et Protection des Routes Web**
- [ ] **Protection des Routes** (`web/src/components/Layout/Layout.tsx`)
  ```typescript
  // V√©rification de l'authentification
  const { session, loading } = useAuth()
  
  if (loading) return <LoadingSpinner />
  if (!session) return <AuthLayout />
  return <MainLayout />
  ```

- [ ] **Gestion des Redirections Web**
  - Redirection automatique apr√®s connexion
  - Protection des routes authentifi√©es
  - Gestion des sessions expir√©es
  - Redirection vers la page appropri√©e selon le r√¥le

#### **3.5 Tests Email/Password**
- [ ] **Tests Unitaires**
  - Test du service d'authentification web
  - Test de la gestion des sessions
  - Test de la validation des entr√©es

- [ ] **Tests d'Int√©gration**
  - Test complet du flux Email/Password
  - Test de la gestion des erreurs
  - Test de la persistance des sessions
  - Test de la r√©initialisation de mot de passe

### **Livrables Phase 3**
- ‚úÖ Service d'authentification web Email/Password
- ‚úÖ √âcrans de connexion/inscription web
- ‚úÖ Gestion des sessions JWT pour web
- ‚úÖ Tests Email/Password valid√©s
- ‚úÖ Navigation et protection des routes web

---

## **Phase 4: Int√©gration et Validation (Semaine 4)** üîó

### **Objectif**
Valider l'int√©gration compl√®te de l'authentification duale, tester les r√¥les et plateformes, et valider la s√©curit√© globale.

### **T√¢ches D√©taill√©es**

#### **4.1 Validation des R√¥les et Plateformes**
- [ ] **Middleware de Validation Plateforme**
  ```typescript
  // lib/middleware/platformValidation.ts
  export const validatePlatformAccess = (userRole: string, platform: 'mobile' | 'web'): boolean => {
    const mobileRoles = ['agent', 'producer']
    const webRoles = ['admin', 'supervisor']
    
    if (platform === 'mobile' && !mobileRoles.includes(userRole)) {
      throw new Error('Acc√®s mobile non autoris√© pour ce r√¥le')
    }
    
    if (platform === 'web' && !webRoles.includes(userRole)) {
      throw new Error('Acc√®s web non autoris√© pour ce r√¥le')
    }
    
    return true
  }
  ```

- [ ] **Validation des Permissions par R√¥le**
  ```typescript
  // lib/auth/rolePermissions.ts
  export const getRolePermissions = (role: UserRole, platform: Platform) => {
    const permissions = {
      agent: ['read_producers', 'create_plots', 'update_observations'],
      producer: ['read_own_plots', 'update_own_observations'],
      supervisor: ['read_cooperative_data', 'validate_agent_data'],
      admin: ['read_all_data', 'manage_users', 'system_config']
    }
    
    return permissions[role] || []
  }
  ```

#### **4.2 Tests RLS et Permissions**
- [ ] **Tests des Politiques RLS**
  ```sql
  -- Test d'acc√®s aux producteurs selon le r√¥le et la plateforme
  -- Doit √©chouer si un agent tente d'acc√©der depuis le web
  -- Doit √©chouer si un admin tente d'acc√©der depuis le mobile
  ```

- [ ] **Tests de S√©curit√©**
  - Test d'acc√®s non autoris√© par plateforme
  - Test d'acc√®s non autoris√© par r√¥le
  - Test de contournement des politiques RLS
  - Test de validation des tokens JWT

#### **4.3 Tests Complets d'Authentification Duale**
- [ ] **Tests End-to-End Mobile**
  ```typescript
  // Test complet du flux OTP SMS
  1. Saisie num√©ro de t√©l√©phone
  2. Envoi OTP SMS
  3. R√©ception et saisie du code
  4. V√©rification et cr√©ation de session
  5. Acc√®s aux fonctionnalit√©s autoris√©es
  6. Test de d√©connexion
  ```

- [ ] **Tests End-to-End Web**
  ```typescript
  // Test complet du flux Email/Password
  1. Saisie email et mot de passe
  2. Connexion et cr√©ation de session
  3. Acc√®s aux fonctionnalit√©s autoris√©es
  4. Test de r√©initialisation de mot de passe
  5. Test de d√©connexion
  ```

#### **4.4 Validation de la S√©curit√©**
- [ ] **Tests de S√©curit√©**
  - Test d'injection SQL
  - Test de XSS
  - Test de CSRF
  - Test de brute force sur OTP
  - Test de brute force sur mot de passe

- [ ] **Audit de S√©curit√©**
  - V√©rification des politiques RLS
  - Validation des tokens JWT
  - V√©rification des logs d'audit
  - Test de la s√©paration des plateformes

#### **4.5 Tests de Performance**
- [ ] **Tests de Performance Mobile**
  - Temps de r√©ponse OTP SMS
  - Performance de l'authentification
  - Gestion des sessions en m√©moire

- [ ] **Tests de Performance Web**
  - Temps de r√©ponse Email/Password
  - Performance de l'authentification
  - Gestion des sessions c√¥t√© serveur

### **Livrables Phase 4**
- ‚úÖ Validation des r√¥les et plateformes
- ‚úÖ Tests RLS et permissions valid√©s
- ‚úÖ Tests complets d'authentification duale
- ‚úÖ Validation de la s√©curit√© globale
- ‚úÖ Tests de performance valid√©s

---

## **Livrables Finaux** üéØ

### **Fonctionnalit√©s Impl√©ment√©es**
- ‚úÖ **Authentification Mobile OTP SMS** : Agents et Producteurs
- ‚úÖ **Authentification Web Email/Password** : Admins et Superviseurs
- ‚úÖ **S√©paration des Plateformes** : Validation stricte plateforme + r√¥le
- ‚úÖ **Gestion des Sessions JWT** : Sessions adapt√©es par plateforme
- ‚úÖ **S√©curit√© RLS** : Politiques de s√©curit√© par plateforme et r√¥le
- ‚úÖ **Audit et Logs** : Tra√ßabilit√© compl√®te des authentifications

### **Architecture Finale**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Frontend Applications                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îÇ
‚îÇ  ‚îÇ   Mobile App   ‚îÇ    ‚îÇ    Web App      ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ  (React Native)‚îÇ    ‚îÇ   (React)       ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ OTP SMS      ‚îÇ    ‚îÇ ‚Ä¢ Email/Password‚îÇ               ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Agents       ‚îÇ    ‚îÇ ‚Ä¢ Admins        ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Producteurs  ‚îÇ    ‚îÇ ‚Ä¢ Superviseurs  ‚îÇ               ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
                               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Supabase Backend                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îÇ
‚îÇ  ‚îÇ   PostgREST     ‚îÇ    ‚îÇ  Edge Functions ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ   (90% CRUD)    ‚îÇ    ‚îÇ  (10% Utils)    ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ 273 endpoints‚îÇ    ‚îÇ ‚Ä¢ Modules partag√©s‚îÇ              ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Auto-g√©n√©r√©   ‚îÇ    ‚îÇ ‚Ä¢ Documentation  ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Haute perf    ‚îÇ    ‚îÇ ‚Ä¢ Monitoring     ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Zero maint    ‚îÇ    ‚îÇ ‚Ä¢ Utilitaires    ‚îÇ               ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
                               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            Supabase Auth Dual (Natif)                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îÇ
‚îÇ  ‚îÇ   OTP SMS      ‚îÇ    ‚îÇ Email/Password  ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ   (Mobile)     ‚îÇ    ‚îÇ   (Web)         ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Agents       ‚îÇ    ‚îÇ ‚Ä¢ Admins        ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Producteurs  ‚îÇ    ‚îÇ ‚Ä¢ Superviseurs  ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Twilio       ‚îÇ    ‚îÇ ‚Ä¢ SMTP          ‚îÇ               ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ JWT 24h      ‚îÇ    ‚îÇ ‚Ä¢ JWT 8h        ‚îÇ               ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## **Risques et Mitigations** ‚ö†Ô∏è

### **Risques Techniques**
- **Risque** : Configuration complexe de Twilio et SMTP
- **Mitigation** : Documentation d√©taill√©e, tests de configuration

- **Risque** : Gestion des sessions multiples par utilisateur
- **Mitigation** : Validation plateforme stricte, logs d'audit

- **Risque** : Tests complexes avec deux m√©thodes d'authentification
- **Mitigation** : Tests s√©par√©s par plateforme, validation crois√©e

### **Risques de S√©curit√©**
- **Risque** : Contournement de la s√©paration plateforme
- **Mitigation** : Validation c√¥t√© serveur, politiques RLS strictes

- **Risque** : Attaques sur OTP SMS
- **Mitigation** : Rate limiting, expiration courte, validation stricte

### **Risques de Performance**
- **Risque** : Latence OTP SMS
- **Mitigation** : Configuration Twilio optimis√©e, fallback en cas d'√©chec

- **Risque** : Gestion des sessions c√¥t√© serveur
- **Mitigation** : Sessions JWT optimis√©es, refresh automatique

---

## **Conclusion** üéØ

Ce plan d'impl√©mentation de **4 semaines** garantit une **authentification duale compl√®te et s√©curis√©e** pour AgriConnect :

1. **Semaine 1** : Configuration Supabase Auth duale
2. **Semaine 2** : Impl√©mentation authentification mobile OTP SMS
3. **Semaine 3** : Impl√©mentation authentification web Email/Password
4. **Semaine 4** : Int√©gration, validation et tests de s√©curit√©

L'approche **mobile-first** avec **s√©paration stricte des plateformes** garantit une **s√©curit√© maximale** et une **exp√©rience utilisateur optimis√©e** pour chaque contexte d'usage.

---

**Derni√®re mise √† jour** : 31 Ao√ªt 2025  
**Statut** : Plan d'impl√©mentation d√©fini  
**Prochaine √©tape** : D√©but de la Phase 1 - Configuration Supabase Auth
